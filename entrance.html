<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GNSQLCB270"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-GNSQLCB270');
    </script>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>$haoø</title>
    <!-- Bootstrap CSS 4.2.1 -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <!-- Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
    <!-- My CSS -->
    <link rel="stylesheet" href="static/css/entrance.css">
</head>
<body>
    <div class="container">
        <div class="col-12 info-title border-bottom border-success border-3 text-center mt-4">
            <h1>$haoø is fierce.</h1>
        </div>
        <div class="row info-1 mt-4">
            <div class="col-6">
                <img src="static/img/shao-logo.jpg" class="shao-logo mx-auto d-block img-thumbnail" alt="shao">
            </div>
            <div class="col-6">
                嗨&nbsp;我是卲如&nbsp;
                <br>我喜歡學習 :)
            </div>
        </div>
        <div class="row info-2 mt-4">
            <div class="col-12">
                <span class="badge rounded-pill bg-success">#shao</span>
                <span class="badge rounded-pill bg-success">#埔心小卲</span>
                <span class="badge rounded-pill bg-success">#猛線</span>
                <span class="badge rounded-pill bg-success">#猛猛</span>
                <span class="badge rounded-pill bg-success">#2811</span>
            </div>
            <div class="col-12 text-center mt-4">
                桃園。埔心&nbsp;&nbsp;<->&nbsp;&nbsp;雲林。斗六
            </div>
        </div>
        <!-- <div class="row info-3 mt-4">
            <div class="col-12 border-top border-success border-3">
                <h4 class="text-center my-4">我現在在做什麼</h4>
                把google sheet當作資料庫儲存，還有API server讓我讀取檔案
            </div>
        </div> -->
            
            <div class="col-12 border-top border-success border-3 leave-message mt-4">
                <h4 class="text-center my-4">跟我交朋友吧！</h4>
                
                <form id="MSG-form" class="px-2" method="POST" action="https://script.google.com/macros/s/AKfycbyA3KuRsnExWKS6aNBfvD6K9EW-EGS1KblrhO-t2kaNiK686WWwaiVSrlHCx13mpV2_/exec">
                    <div class="make-friend-YorN">
                        <div class="form-group make-friend-btn-form-group mx-2 text-center">
                            <button type="button" class="btn btn-sm btn-yes" onclick="makeFriend('yes')">
                                Yes
                            </button>
                            <button type="button" class="btn btn-sm btn-no" onclick="makeFriend('no')">
                                No
                            </button>
                            <input type="hidden" id="Yes_or_No" name="Yes_or_No" value = "unsure" required>
                        </div>
                    </div>
                    <div class="form-group mx-2">
                        <label for="NameOfLeavingMsg">▼ 暱稱</label>
                        <input class="form-control" id="NameOfLeavingMsg" type="text" name="Name" placeholder="暱稱" required aria-label=".form-control">
                    </div>
                    <div class="form-group mx-2">
                        <label for="Msg">▼ 留下一句話</label>
                        <input class="form-control" id="Msg" type="textarea" name="Msg" placeholder="留言" required aria-label=".form-control">
                    </div>
                    <button type="submit" class="btn btn-sm btn-submit mx-2" >送出</button>
                </form>
            </div>
        <div class="row info-3 mt-4">
            <div class="col-12 border-top border-success border-3">
                <h4 class="text-center my-4">目前我有 <span id="Number_Of_Friends">0</span> 位朋友！</h4>
            </div>
            <div class="col-12">
                <table id="MsgTable" class="mx-auto w-75">
                    <thead>
                        <tr>
                            <th>時間</th>
                            <th>名稱</th>
                            <th>留言</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
            <div class="col-12 text-center my-4">
                歡迎一直點進來，我會努力持續優化的！
            </div>
        </div>
            
    </div>
</body>
<script>
    window.addEventListener("load", function() {
    const form = document.getElementById('MSG-form');
    form.addEventListener("submit", function(e) {
        e.preventDefault();
        const data = new FormData(form);
        const action = e.target.action;
        fetch(action, {
        method: 'POST',
        body: data,
        })
        .then(() => {
            window.location.href = "https://shao112.github.io/shao/entrance.html";
        })
    });
    });
    // document.getElementById("MSG-form").onsubmit = function(event){
    //     event.preventDefault();
    //     window.location.href = "https://shao112.github.io/shao/entrance.html";
    // };
    function makeFriend(ans){
        if(ans == "yes"){
            var yesBtn = document.querySelector(".btn-no");
            yesBtn.setAttribute('disabled','');

            var yes = document.querySelector("#Yes_or_No");
            yes.value = "yes"
            alert("謝謝跟我當朋友，不能反悔了ㄡ")
        }else if(ans == "no"){
            var no = document.querySelector("#Yes_or_No");
            no.value = "no"
            alert("真的不當朋友嗎")
        }
    }

    const sheetId = '1QKdxwpTEGi_wa5B96G9GmTolHg8nPppbBzkPRImLDRo';
    const range = 'Shao留言板!A2:$C';
    const apiKey = 'AIzaSyBIdagodBjndLFGnQ2NvcH_ZT6-NW90Gvw';

    const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`;

    fetch(url)
    .then(response => response.json())
    .then(data => {
        document.getElementById("Number_Of_Friends").innerHTML = data.values.length
        var tableBody = document.getElementById("MsgTable").getElementsByTagName("tbody")[0];

        for (var i = 0; i < data.values.length; i++) {
            var row = document.createElement("tr");
            var cell1 = document.createElement("td");
            cell1.innerHTML = data.values[i][0];
            row.appendChild(cell1);

            var cell2 = document.createElement("td");
            cell2.innerHTML = data.values[i][1];
            row.appendChild(cell2);

            var cell3 = document.createElement("td");
            cell3.innerHTML = data.values[i][2];
            row.appendChild(cell3);

            tableBody.appendChild(row);
        }
    })
    .catch(error => {
        console.error('Error fetching data:', error);
    });



</script>
</html>
